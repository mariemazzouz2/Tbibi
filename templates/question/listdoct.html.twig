{% extends 'base.html.twig' %}

{% block title %}
    Questions
{% endblock %}

{% block body %}
    <div class="container mt-5" style="max-width: 900px;">
    
        <!-- Barre de recherche -->
        <div class="input-group mb-4">
            <input type="text" id="search-input" class="form-control" placeholder="Rechercher une question..." aria-label="Rechercher" style="border-radius: 20px;">
            <button class="btn btn-primary" type="button" style="border-radius: 20px;">üîç</button>
        </div>

        <!-- Liste des questions -->
        <div id="questions-list" class="list-group shadow-lg rounded" style="border-radius: 10px;height:400px;overflow-y:scroll">
            {% for question in questions %}
                <a href="{{ path('question_show', {id: question.id}) }}" class="list-group-item list-group-item-action" style="border-radius: 10px; margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                    <h5 class="mb-1" style="font-size: 1.2rem; color: #007bff;">{{ question.titre }}</h5>
                    <p class="mb-1" style="font-size: 1rem; color: #555;">{{ question.contenu|slice(0, 100) ~ '...' }}</p>
                    {% if question.visible == true %}
                        <p class="text-muted" style="font-size: 0.9rem;">Post√© par : {{ question.patient.nom }}</p>
                    {% endif %}
                </a>    
            {% else %}
                <p>Aucune question disponible.</p>
            {% endfor %}
        </div>
    </div>

    <script>
        // Fonction pour effectuer la recherche en AJAX
        document.getElementById('search-input').addEventListener('input', function() {
            let query = this.value;

            // Envoie la requ√™te AJAX si la recherche n'est pas vide
            if (query.length >= 1) {
                fetch(`/questions/search?query=${query}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    // Vider la liste actuelle
                    let questionsList = document.getElementById('questions-list');
                    questionsList.innerHTML = '';

                    // Afficher les r√©sultats de la recherche
                    if (data.length > 0) {
                        data.forEach(question => {
                            let questionItem = document.createElement('a');
                            questionItem.href = '/question/' + question.id;
                            questionItem.className = 'list-group-item list-group-item-action';
                            questionItem.style = 'border-radius: 10px; margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);';
                            
                            let questionTitle = document.createElement('h5');
                            questionTitle.className = 'mb-1';
                            questionTitle.style = 'font-size: 1.2rem; color: #007bff;';
                            questionTitle.textContent = question.titre;
                            
                            let questionContent = document.createElement('p');
                            questionContent.className = 'mb-1';
                            questionContent.style = 'font-size: 1rem; color: #555;';
                            questionContent.textContent = question.contenu.slice(0, 100) + '...';

                            let questionPostedBy = document.createElement('p');
                            questionPostedBy.className = 'text-muted';
                            questionPostedBy.style = 'font-size: 0.9rem;';
                            questionPostedBy.textContent = 'Post√© par : ' + question.patient.nom;

                            questionItem.appendChild(questionTitle);
                            questionItem.appendChild(questionContent);
                            questionItem.appendChild(questionPostedBy);

                            questionsList.appendChild(questionItem);
                        });
                    } else {
                        let noResults = document.createElement('p');
                        noResults.textContent = 'Aucune question trouv√©e.';
                        questionsList.appendChild(noResults);
                    }
                })
                .catch(error => console.log('Erreur:', error));
            } else {
                // Si la recherche est vide, afficher toutes les questions
                fetch('/docteur/questions')
                    .then(response => response.json())
                    .then(data => {
                        let questionsList = document.getElementById('questions-list');
                        questionsList.innerHTML = '';
                        data.forEach(question => {
                            let questionItem = document.createElement('a');
                            questionItem.href = '/question/' + question.id;
                            questionItem.className = 'list-group-item list-group-item-action';
                            questionItem.style = 'border-radius: 10px; margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);';
                            
                            let questionTitle = document.createElement('h5');
                            questionTitle.className = 'mb-1';
                            questionTitle.style = 'font-size: 1.2rem; color: #007bff;';
                            questionTitle.textContent = question.titre;
                            
                            let questionContent = document.createElement('p');
                            questionContent.className = 'mb-1';
                            questionContent.style = 'font-size: 1rem; color: #555;';
                            questionContent.textContent = question.contenu.slice(0, 100) + '...';

                            let questionPostedBy = document.createElement('p');
                            questionPostedBy.className = 'text-muted';
                            questionPostedBy.style = 'font-size: 0.9rem;';
                            questionPostedBy.textContent = 'Post√© par : ' + question.patient.nom;

                            questionItem.appendChild(questionTitle);
                            questionItem.appendChild(questionContent);
                            questionItem.appendChild(questionPostedBy);

                            questionsList.appendChild(questionItem);
                        });
                    })
                    .catch(error => console.log('Erreur:', error));
            }
        });
    </script>
{% endblock %}
